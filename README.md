# Flask宿舍管理系统分析文档

## 项目概述

这是一个基于Flask框架开发的**学生宿舍管理系统**，主要用于高校学生宿舍的分配、管理和查询。系统实现了学生注册、登录、宿舍分配、状态查询等核心功能。

## 技术栈分析

### 后端框架
- **Flask**: 轻量级Python Web框架，作为整个系统的核心
- **Flask-SQLAlchemy**: SQLAlchemy的Flask扩展，用于ORM数据库操作
- **SQLite**: 轻量级关系型数据库，存储系统数据

### 前端技术
- **HTML模板**: 使用Flask的Jinja2模板引擎
- **Bootstrap**: 前端UI框架（推测，基于表单结构）

### 核心Python库
- `sqlite3`: 数据库连接和操作
- `datetime`: 时间处理（学号生成）
- `os`: 文件路径操作

## 数据库设计

### 数据表结构

#### 1. 专业表 (majors)
```sql
- id: 主键
- name: 专业名称
- code: 专业代码
```

#### 2. 学生表 (students)
```sql
- student_id: 学号（主键）
- id_card: 身份证号
- name: 姓名
- gender: 性别
- schedule: 作息时间
- major_id: 专业ID（外键）
- accept_other_major: 是否接受其他专业室友
- bed_pref: 床位偏好
- dorm_size: 宿舍规模偏好
- hobbies: 爱好
- dorm_id: 宿舍ID（外键）
```

#### 3. 宿舍表 (dormitories)
```sql
- id: 主键
- building: 楼栋
- room_number: 房间号
- capacity: 容量
- gender: 性别限制
```

#### 4. 床位表 (beds)
```sql
- id: 主键
- bed_number: 床位号
- dorm_id: 宿舍ID（外键）
- status: 床位状态
- student_id: 学生ID（外键）
```

### 关系设计
- 学生-专业：多对一关系
- 学生-宿舍：多对一关系
- 宿舍-床位：一对多关系
- 学生-床位：一对一关系

## 功能模块分析

### 1. 用户注册模块 (`/register`)
**功能**: 新学生注册入学信息
- 收集学生基本信息（姓名、身份证、性别等）
- 选择专业、作息时间、宿舍偏好
- 自动生成学号（格式：年份+专业代码+4位序号）
- 记录兴趣爱好（用于室友匹配）

### 2. 用户登录模块 (`/login`)
**功能**: 学生通过学号登录系统
- 验证学号有效性
- 重定向到个人信息页面

### 3. 个人信息查看 (`/profile/<student_id>`)
**功能**: 显示学生详细信息
- 基本信息展示
- 专业信息显示
- 宿舍分配状态

### 4. 宿舍分配模块 (`/assign_dorm/<student_id>`)
**功能**: 自动分配宿舍
- 根据学生性别筛选可用宿舍
- 自动选择第一个可用宿舍和床位
- 更新床位占用状态

### 5. 宿舍状态查询 (`/dorm_status`)
**功能**: 宿舍管理和状态监控
- 多条件筛选（楼栋、容量、性别、入住率）
- 显示每个宿舍的详细信息
- 床位分配情况和学生信息
- 入住率统计

### 6. 学生状态查询 (`/student_status/<student_id>`)
**功能**: 查看学生详细居住信息
- 学生基本信息
- 宿舍和床位信息
- 室友信息展示

### 7. 学生搜索功能 (`/search_student`)
**功能**: 通过学号快速查找学生信息

## 系统特色功能

### 1. 智能学号生成
- 格式：年份(4位) + 专业代码 + 序号(4位)
- 自动递增序号，避免重复

### 2. 个性化匹配参数
- 作息时间偏好
- 宿舍规模偏好
- 床位偏好（上铺/下铺）
- 兴趣爱好记录
- 是否接受跨专业室友

### 3. 多维度查询筛选
- 按楼栋筛选
- 按容量筛选
- 按性别筛选
- 按入住率筛选（空闲/部分入住/满员）

## 代码架构特点

### 1. MVC架构模式
- **Model**: SQLAlchemy ORM模型定义
- **View**: HTML模板渲染
- **Controller**: Flask路由函数处理业务逻辑

### 2. 数据库操作方式
- 主要使用SQLAlchemy ORM
- 部分功能保留原生SQL支持（`get_db()`函数）

### 3. 错误处理
- 使用Flask的`flash`消息系统
- 数据验证和错误重定向

## 系统优势

1. **轻量级部署**: 使用SQLite数据库，无需复杂数据库配置
2. **用户友好**: 提供直观的Web界面操作
3. **功能完整**: 覆盖宿舍管理的核心需求
4. **扩展性好**: 基于Flask框架，易于功能扩展
5. **数据关系清晰**: 良好的数据库设计，支持复杂查询

## 潜在改进方向

1. **智能分配算法**: 当前为简单的先到先得，可以基于兴趣爱好、作息时间等进行智能匹配
2. **权限管理**: 增加管理员角色和权限控制
3. **数据导入导出**: 支持批量数据处理
4. **移动端适配**: 响应式设计优化
5. **通知系统**: 宿舍分配结果通知功能

## 使用场景

这个系统适用于：
- 高等院校新生宿舍分配
- 学生宿舍日常管理
- 宿舍入住率统计和监控
- 学生住宿信息查询

## 总结

该系统是一个功能完整的学生宿舍管理解决方案，采用现代Web开发技术栈，具有良好的可维护性和扩展性。通过合理的数据库设计和清晰的业务逻辑，有效解决了高校宿舍管理的核心需求。
